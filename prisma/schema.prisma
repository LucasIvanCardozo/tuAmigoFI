generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

model contributors {
  dni      String     @id @db.VarChar
  name     String     @db.VarChar
  problems problems[]
}

model correlatives {
  id                                           Int
  id_correlative                               Int
  courses_correlatives_id_correlativeTocourses courses @relation("correlatives_id_correlativeTocourses", fields: [id_correlative], references: [id], onDelete: Cascade, onUpdate: NoAction)
  courses_correlatives_idTocourses             courses @relation("correlatives_idTocourses", fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([id, id_correlative])
}

model courses {
  id                                                Int               @id @default(autoincrement())
  name                                              String            @unique @db.VarChar
  name_normalized                                   String            @db.VarChar
  cg                                                Int?
  hs                                                Int?
  optional                                          Boolean           @default(false)
  correlatives_correlatives_id_correlativeTocourses correlatives[]    @relation("correlatives_id_correlativeTocourses")
  correlatives_correlatives_idTocourses             correlatives[]    @relation("correlatives_idTocourses")
  courses_degrees                                   courses_degrees[]
  courses_links                                     courses_links[]
  courses_years                                     courses_years[]
  midterms                                          midterms[]
  tps_courses                                       tps_courses[]

  @@index([name_normalized])
}

model courses_degrees {
  courses_id Int
  degrees_id Int
  courses    courses @relation(fields: [courses_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  degrees    degrees @relation(fields: [degrees_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([courses_id, degrees_id])
}

model courses_links {
  courses_id Int
  links_id   Int
  courses    courses @relation(fields: [courses_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  links      links   @relation(fields: [links_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([courses_id, links_id])
}

model courses_years {
  courses_id Int
  years_id   Int
  courses    courses @relation(fields: [courses_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  years      years   @relation(fields: [years_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([courses_id, years_id])
}

model degrees {
  id              Int               @id @default(autoincrement())
  name            String            @unique @db.VarChar
  courses_degrees courses_degrees[]
  degrees_plans   degrees_plans[]
}

model degrees_plans {
  degrees_id Int
  plans_id   Int
  degrees    degrees @relation(fields: [degrees_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  plans      plans   @relation(fields: [plans_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([degrees_id, plans_id])
}

model links {
  id            Int             @id @default(autoincrement())
  name          String          @db.VarChar
  link          String          @db.VarChar
  official      Boolean
  courses_links courses_links[]
}

model midterms {
  id        Int        @id @default(autoincrement())
  id_course Int
  name      String     @db.VarChar
  date      DateTime   @db.Date
  courses   courses    @relation(fields: [id_course], references: [id], onDelete: NoAction, onUpdate: NoAction)
  problems  problems[]
}

model plans {
  id            Int             @id @default(autoincrement())
  year          Int             @unique
  degrees_plans degrees_plans[]
}

model problems {
  id              Int              @id @default(autoincrement())
  id_midterms     Int?
  number          Int?
  text            String           @db.VarChar
  text_normalized String           @db.VarChar
  response_plus   String?          @db.VarChar
  type_plus       String?          @db.VarChar(5)
  id_contributors String?          @db.VarChar
  response        Boolean?
  contributors    contributors?    @relation(fields: [id_contributors], references: [dni], onDelete: NoAction, onUpdate: NoAction)
  midterms        midterms?        @relation(fields: [id_midterms], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tps_problems    tps_problems[]
  user_reactions  user_reactions[]

  @@index([text_normalized])
}

model tps {
  id           Int            @id @default(autoincrement())
  name         String         @db.VarChar
  number       Int?
  year         Int
  tps_courses  tps_courses[]
  tps_problems tps_problems[]

  @@unique([name, year], map: "tps_name_year_idx")
}

model tps_courses {
  tps_id     Int
  courses_id Int
  courses    courses @relation(fields: [courses_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tps        tps     @relation(fields: [tps_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tps_id, courses_id])
}

model tps_problems {
  tps_id      Int
  problems_id Int
  problems    problems @relation(fields: [problems_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tps         tps      @relation(fields: [tps_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([tps_id, problems_id])
}

model user_reactions {
  id         Int       @id @default(autoincrement())
  id_user    String    @db.VarChar(36)
  id_problem Int
  reaction   Int
  created_at DateTime? @default(now()) @db.Timestamp(6)
  problems   problems  @relation(fields: [id_problem], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users      users     @relation(fields: [id_user], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([id_user, id_problem], map: "user_reactions_id_user_id_problem_idx")
}

model users {
  id             String           @id @db.VarChar(36)
  user_reactions user_reactions[]

  @@index([id])
}

model years {
  id            Int             @id @default(autoincrement())
  name          String          @unique @db.VarChar
  courses_years courses_years[]
}
